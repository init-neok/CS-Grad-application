{% extends "base.html" %}
{% block title %}Dashboard Â· CS Grad Insight{% endblock %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4 flex-wrap gap-3">
  <h1 class="h3 m-0">My Dashboard</h1>
  <div class="text-end">
    <button class="btn btn-sm btn-outline-secondary" id="profile-expand-btn" title="Toggle detailed profile editor">
      Expand Profile Editor
    </button>
  </div>
</div>

<div id="dashboard-alert" class="alert d-none mt-3 mb-4" role="alert"></div>

<div class="row g-4">
  <div class="col-lg-6">
    <div class="card shadow-sm h-100">
      <div class="card-header bg-light border-bottom">
        <h2 class="h5 m-0">Profile Snapshot</h2>
        <small class="text-muted">Your background information</small>
      </div>
      <div class="card-body">
        <form id="profile-form" class="vstack gap-3">
          <div>
            <label class="form-label">Preferred Name</label>
            <input class="form-control" name="preferred_name" placeholder="How you'd like to be addressed" />
          </div>
          <div class="row g-3">
            <div class="col">
              <label class="form-label">GPA</label>
              <input class="form-control" name="gpa" type="number" step="0.01" min="0" placeholder="e.g., 3.85" />
            </div>
            <div class="col">
              <label class="form-label">GPA Scale</label>
              <input class="form-control" name="gpa_scale" type="number" step="0.01" min="0" placeholder="e.g., 4.0" />
            </div>
          </div>
          <div class="row g-3">
            <div class="col">
              <label class="form-label">GRE Total</label>
              <input class="form-control" name="gre_total" type="number" min="0" max="340" placeholder="e.g., 325" />
            </div>
            <div class="col">
              <label class="form-label">TOEFL Total</label>
              <input class="form-control" name="toefl_total" type="number" min="0" max="120" placeholder="e.g., 110" />
            </div>
          </div>
          <div class="row g-3">
            <div class="col">
              <label class="form-label">Recommendation Strength</label>
              <select class="form-select" name="recommendation_strength">
                <option value="">Not specified</option>
                <option value="strong">Strong</option>
                <option value="moderate">Moderate</option>
                <option value="average">Average</option>
              </select>
            </div>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" id="research_experience" name="research_experience" />
            <label class="form-check-label" for="research_experience">
              <strong>Research experience</strong> (publications, labs, etc.)
            </label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" id="internship_experience" name="internship_experience" />
            <label class="form-check-label" for="internship_experience">
              <strong>Internship experience</strong> (industry, startups, etc.)
            </label>
          </div>
          <div>
            <label class="form-label">Notes</label>
            <textarea class="form-control" name="notes" rows="2" placeholder="e.g., Research interests, specializations..."></textarea>
          </div>
          <button class="btn btn-primary" type="submit">
            <span class="spinner-border spinner-border-sm me-2 d-none" id="profile-loading"></span>
            Save Profile
          </button>
        </form>
      </div>
    </div>
  </div>
  <div class="col-lg-6">
    <div class="card shadow-sm h-100">
      <div class="card-header bg-light border-bottom">
        <h2 class="h5 m-0">Add Application Result</h2>
        <small class="text-muted">Record your application outcomes</small>
      </div>
      <div class="card-body">
        <form id="application-form" class="vstack gap-3">
          <div>
            <label class="form-label">University <span class="text-danger">*</span></label>
            <input class="form-control" name="university" required placeholder="e.g., Stanford University" />
          </div>
          <div>
            <label class="form-label">Program <span class="text-danger">*</span></label>
            <input class="form-control" name="program" required placeholder="e.g., MS Computer Science" />
          </div>
          <div class="row g-3">
            <div class="col">
              <label class="form-label">Degree</label>
              <select class="form-select" name="degree">
                <option value="">Not specified</option>
                <option>MS</option>
                <option>PhD</option>
                <option>MEng</option>
                <option>Other</option>
              </select>
            </div>
            <div class="col">
              <label class="form-label">Application Term</label>
              <input class="form-control" name="term" placeholder="e.g., Fall 2025" />
            </div>
          </div>
          <div>
            <label class="form-label">Country / Region</label>
            <input class="form-control" name="country" placeholder="e.g., USA, Canada" />
          </div>
          <div>
            <label class="form-label">Application Result <span class="text-danger">*</span></label>
            <select class="form-select" name="result" required>
              <option value="">-- Please select --</option>
              <option value="Admit">Admit</option>
              <option value="Reject">Reject</option>
              <option value="Waitlist">Waitlist</option>
            </select>
          </div>
          <div>
            <label class="form-label">Funding / Scholarship</label>
            <input class="form-control" name="funding" placeholder="e.g., Full scholarship, TA/RA offer" />
          </div>
          <div class="row g-3">
            <div class="col">
              <label class="form-label">Reported GPA</label>
              <input class="form-control" name="gpa" type="number" step="0.01" min="0" placeholder="e.g., 3.85" />
            </div>
            <div class="col">
              <label class="form-label">GPA Scale</label>
              <input class="form-control" name="gpa_scale" type="number" step="0.01" min="0" placeholder="e.g., 4.0" />
            </div>
          </div>
          <div class="row g-3">
            <div class="col">
              <label class="form-label">GRE Total</label>
              <input class="form-control" name="gre_total" type="number" min="0" max="340" placeholder="e.g., 325" />
            </div>
            <div class="col">
              <label class="form-label">Recommendation Strength</label>
              <select class="form-select" name="recommendation_strength">
                <option value="">Not specified</option>
                <option value="strong">Strong</option>
                <option value="moderate">Moderate</option>
                <option value="average">Average</option>
              </select>
            </div>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" id="app_research" name="research_experience" />
            <label class="form-check-label" for="app_research">
              Had relevant research experience
            </label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" id="app_internship" name="internship_experience" />
            <label class="form-check-label" for="app_internship">
              Had relevant internship/work experience
            </label>
          </div>
          <div>
            <label class="form-label">Additional Notes</label>
            <textarea class="form-control" name="notes" rows="2" placeholder="e.g., Interview result, special circumstances..."></textarea>
          </div>
          <button class="btn btn-success" type="submit">
            <span class="spinner-border spinner-border-sm me-2 d-none" id="app-loading"></span>
            Add Application
          </button>
        </form>
      </div>
    </div>
  </div>
</div>

<div class="row g-4 mt-3">
  <div class="col-lg-7">
    <div class="card shadow-sm">
      <div class="card-header bg-light border-bottom">
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <h2 class="h5 m-0">My Applications</h2>
            <small class="text-muted">Track your application results</small>
          </div>
          <button class="btn btn-sm btn-outline-secondary" id="refresh-applications" title="Refresh application list">
            <span class="spinner-border spinner-border-sm me-1 d-none" id="refresh-apps-spinner"></span>
            Refresh
          </button>
        </div>
      </div>
      <div class="card-body p-0">
        <div class="table-responsive" style="max-height: 500px">
          <table class="table table-sm align-middle mb-0">
            <thead class="table-light position-sticky top-0">
              <tr>
                <th>University</th>
                <th>Program</th>
                <th>Term</th>
                <th>Result</th>
                <th class="text-center">Actions</th>
              </tr>
            </thead>
            <tbody id="applications-table">
              <tr>
                <td colspan="5" class="text-center text-muted py-4">Loading applications...</td>
              </tr>
            </tbody>
          </table>
        </div>
        <div id="empty-applications-msg" class="alert alert-info m-3 mb-0 d-none" role="alert">
          No applications recorded yet. Add one using the form above!
        </div>
      </div>
    </div>
  </div>
  <div class="col-lg-5">
    <div class="card shadow-sm h-100">
      <div class="card-header bg-light border-bottom">
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <h2 class="h5 m-0">Program Recommendations</h2>
            <small class="text-muted">Based on your profile</small>
          </div>
          <button class="btn btn-sm btn-outline-primary" id="refresh-suggestions" title="Refresh match suggestions">
            <span class="spinner-border spinner-border-sm me-1 d-none" id="refresh-sugg-spinner"></span>
            Update
          </button>
        </div>
      </div>
      <div class="card-body p-0">
        <div id="suggestions" class="small p-3" style="max-height: 500px; overflow-y: auto">
          <p class="text-muted text-center py-4">Loading suggestions...</p>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
{% block scripts %}
<script src="{{ url_for('static', filename='js/dashboard.js') }}" defer></script>
{% endblock %}
